


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html id="htmlId">
<head>
  <title>Coverage Report :: TMADataImporter</title>
  <style type="text/css">
    @import "../../.css/coverage.css";
  </style>
</head>

<body>
<div class="header"></div>

<div class="content">
<div class="breadCrumbs">
    [ <a href="../../index.html">all classes</a> ]
    [ <a href="../index.html">qupath.lib.gui.commands</a> ]
</div>

<h1>Coverage Summary for Class: TMADataImporter (qupath.lib.gui.commands)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">TMADataImporter</td>
<td class="coverageStat">
  <span class="percent">
    11.1%
  </span>
  <span class="absValue">
    (2/ 18)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    3.7%
  </span>
  <span class="absValue">
    (7/ 190)
  </span>
</td>
</tr>
  <tr>
    <td class="name">TMADataImporter$CoreInfo</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 16)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TMADataImporter$CoreInfoGrid</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 9)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 20)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TMADataImporter$CoreInfoRow</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TMADataImporter$CoreInfoTableCell</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 22)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>total</strong></td>
<td class="coverageStat">
  <span class="percent">
    5.7%
  </span>
  <span class="absValue">
    (2/ 35)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    2.8%
  </span>
  <span class="absValue">
    (7/ 252)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<div class="sourceCode"><i>1</i>&nbsp;/*-
<i>2</i>&nbsp; * #%L
<i>3</i>&nbsp; * This file is part of QuPath.
<i>4</i>&nbsp; * %%
<i>5</i>&nbsp; * Copyright (C) 2014 - 2016 The Queen&#39;s University of Belfast, Northern Ireland
<i>6</i>&nbsp; * Contact: IP Management (ipmanagement@qub.ac.uk)
<i>7</i>&nbsp; * Copyright (C) 2018 - 2020 QuPath developers, The University of Edinburgh
<i>8</i>&nbsp; * %%
<i>9</i>&nbsp; * QuPath is free software: you can redistribute it and/or modify
<i>10</i>&nbsp; * it under the terms of the GNU General Public License as
<i>11</i>&nbsp; * published by the Free Software Foundation, either version 3 of the
<i>12</i>&nbsp; * License, or (at your option) any later version.
<i>13</i>&nbsp; * 
<i>14</i>&nbsp; * QuPath is distributed in the hope that it will be useful,
<i>15</i>&nbsp; * but WITHOUT ANY WARRANTY; without even the implied warranty of
<i>16</i>&nbsp; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
<i>17</i>&nbsp; * GNU General Public License for more details.
<i>18</i>&nbsp; * 
<i>19</i>&nbsp; * You should have received a copy of the GNU General Public License 
<i>20</i>&nbsp; * along with QuPath.  If not, see &lt;https://www.gnu.org/licenses/&gt;.
<i>21</i>&nbsp; * #L%
<i>22</i>&nbsp; */
<i>23</i>&nbsp;
<i>24</i>&nbsp;package qupath.lib.gui.commands;
<i>25</i>&nbsp;
<i>26</i>&nbsp;import java.io.File;
<i>27</i>&nbsp;import java.io.FileNotFoundException;
<i>28</i>&nbsp;import java.io.IOException;
<i>29</i>&nbsp;import java.util.ArrayList;
<i>30</i>&nbsp;import java.util.Collections;
<i>31</i>&nbsp;import java.util.LinkedHashMap;
<i>32</i>&nbsp;import java.util.List;
<i>33</i>&nbsp;import java.util.Map;
<i>34</i>&nbsp;import java.util.Map.Entry;
<i>35</i>&nbsp;import java.util.Scanner;
<i>36</i>&nbsp;import java.util.Set;
<i>37</i>&nbsp;import java.util.WeakHashMap;
<i>38</i>&nbsp;
<i>39</i>&nbsp;import org.slf4j.Logger;
<i>40</i>&nbsp;import org.slf4j.LoggerFactory;
<i>41</i>&nbsp;
<i>42</i>&nbsp;import javafx.beans.property.ReadOnlyObjectWrapper;
<i>43</i>&nbsp;import javafx.geometry.Insets;
<i>44</i>&nbsp;import javafx.geometry.Pos;
<i>45</i>&nbsp;import javafx.scene.control.Button;
<i>46</i>&nbsp;import javafx.scene.control.ButtonType;
<i>47</i>&nbsp;import javafx.scene.control.ContentDisplay;
<i>48</i>&nbsp;import javafx.scene.control.TableCell;
<i>49</i>&nbsp;import javafx.scene.control.TableColumn;
<i>50</i>&nbsp;import javafx.scene.control.TableView;
<i>51</i>&nbsp;import javafx.scene.control.Tooltip;
<i>52</i>&nbsp;import javafx.scene.input.Clipboard;
<i>53</i>&nbsp;import javafx.scene.layout.BorderPane;
<i>54</i>&nbsp;import javafx.scene.layout.GridPane;
<i>55</i>&nbsp;import javafx.scene.layout.Pane;
<i>56</i>&nbsp;import javafx.scene.text.TextAlignment;
<i>57</i>&nbsp;import qupath.lib.common.GeneralTools;
<i>58</i>&nbsp;import qupath.lib.gui.QuPathGUI;
<i>59</i>&nbsp;import qupath.lib.gui.dialogs.Dialogs;
<i>60</i>&nbsp;import qupath.lib.gui.prefs.PathPrefs;
<i>61</i>&nbsp;import qupath.lib.gui.tools.ColorToolsFX;
<i>62</i>&nbsp;import qupath.lib.gui.tools.PaneTools;
<i>63</i>&nbsp;import qupath.lib.images.ImageData;
<i>64</i>&nbsp;import qupath.lib.io.TMAScoreImporter;
<i>65</i>&nbsp;import qupath.lib.objects.TMACoreObject;
<i>66</i>&nbsp;import qupath.lib.objects.hierarchy.PathObjectHierarchy;
<i>67</i>&nbsp;import qupath.lib.objects.hierarchy.TMAGrid;
<i>68</i>&nbsp;
<i>69</i>&nbsp;/**
<i>70</i>&nbsp; * Command for importing TMA maps &amp;amp; additional info (e.g. manual scores).
<i>71</i>&nbsp; * 
<i>72</i>&nbsp; * @author Pete Bankhead
<i>73</i>&nbsp; *
<i>74</i>&nbsp; */
<b class="nc"><i>75</i>&nbsp;class TMADataImporter {</b>
<i>76</i>&nbsp;
<b class="fc"><i>77</i>&nbsp;	final private static Logger logger = LoggerFactory.getLogger(TMADataImporter.class);</b>
<i>78</i>&nbsp;	
<b class="fc"><i>79</i>&nbsp;	private static String TITLE = &quot;Import TMA data&quot;;</b>
<i>80</i>&nbsp;	
<i>81</i>&nbsp;	
<b class="fc"><i>82</i>&nbsp;	private static Set&lt;QuPathGUI&gt; installedHandlers = Collections.newSetFromMap(new WeakHashMap&lt;&gt;());</b>
<i>83</i>&nbsp;	
<i>84</i>&nbsp;	public static synchronized void installDragAndDropHandler(QuPathGUI qupath) {
<b class="fc"><i>85</i>&nbsp;		if (installedHandlers.contains(qupath)) {</b>
<b class="nc"><i>86</i>&nbsp;			logger.warn(TITLE + &quot; file drag &amp; drop already installed for this QuPath instance!&quot;);</b>
<b class="nc"><i>87</i>&nbsp;			return;</b>
<i>88</i>&nbsp;		}
<b class="fc"><i>89</i>&nbsp;		installedHandlers.add(qupath);</b>
<i>90</i>&nbsp;		// Support dragging a TMA map onto the image
<b class="fc"><i>91</i>&nbsp;		qupath.getDefaultDragDropListener().addFileDropHandler((viewer, list) -&gt; {</b>
<b class="nc"><i>92</i>&nbsp;			if (list.isEmpty())</b>
<b class="nc"><i>93</i>&nbsp;				return false;</b>
<b class="nc"><i>94</i>&nbsp;			ImageData&lt;?&gt; imageData = qupath.getImageData();</b>
<b class="nc"><i>95</i>&nbsp;			if (imageData == null || imageData.getHierarchy().getTMAGrid() == null)</b>
<b class="nc"><i>96</i>&nbsp;				return false;</b>
<b class="nc"><i>97</i>&nbsp;			File file = list.get(0);</b>
<b class="nc"><i>98</i>&nbsp;			if (file.getName().toLowerCase().endsWith(&quot;.qpmap&quot;)) {</b>
<i>99</i>&nbsp;				try {
<b class="nc"><i>100</i>&nbsp;					CoreInfoGrid grid = new CoreInfoGrid(imageData.getHierarchy().getTMAGrid());</b>
<b class="nc"><i>101</i>&nbsp;					boolean success = handleImportGrid(grid, GeneralTools.readFileAsString(file.getAbsolutePath()));</b>
<b class="nc"><i>102</i>&nbsp;					if (success) {</b>
<b class="nc"><i>103</i>&nbsp;						grid.synchronizeTMAGridToInfo();</b>
<b class="nc"><i>104</i>&nbsp;						imageData.getHierarchy().fireObjectsChangedEvent(grid, imageData.getHierarchy().getTMAGrid().getTMACoreList());</b>
<b class="nc"><i>105</i>&nbsp;						Dialogs.showInfoNotification(TITLE, &quot;TMA grid imported (&quot; + grid.getGridWidth() + &quot;x&quot; + grid.getGridHeight() + &quot;)&quot;);</b>
<b class="nc"><i>106</i>&nbsp;						return true;</b>
<i>107</i>&nbsp;					}
<b class="nc"><i>108</i>&nbsp;				} catch (Exception e) {</b>
<b class="nc"><i>109</i>&nbsp;					logger.error(&quot;Error importing TMA grid&quot;, e);</b>
<b class="nc"><i>110</i>&nbsp;				}</b>
<i>111</i>&nbsp;			}
<b class="nc"><i>112</i>&nbsp;			return false;</b>
<i>113</i>&nbsp;		});
<b class="fc"><i>114</i>&nbsp;	}</b>
<i>115</i>&nbsp;	
<i>116</i>&nbsp;		
<i>117</i>&nbsp;	public static void importTMAData(ImageData&lt;?&gt; imageData) {
<b class="nc"><i>118</i>&nbsp;		if (imageData == null) {</b>
<b class="nc"><i>119</i>&nbsp;			Dialogs.showNoImageError(TITLE);</b>
<b class="nc"><i>120</i>&nbsp;			return;</b>
<i>121</i>&nbsp;		}
<b class="nc"><i>122</i>&nbsp;		PathObjectHierarchy hierarchy = imageData.getHierarchy();</b>
<b class="nc"><i>123</i>&nbsp;		if (hierarchy.getTMAGrid() == null) {</b>
<b class="nc"><i>124</i>&nbsp;			Dialogs.showErrorMessage(TITLE, &quot;No TMA grid has been set for the selected image!&quot;);</b>
<b class="nc"><i>125</i>&nbsp;			return;</b>
<i>126</i>&nbsp;		}
<i>127</i>&nbsp;		
<i>128</i>&nbsp;		// Show a GUI with the current TMA grid status
<b class="nc"><i>129</i>&nbsp;		TMAGrid grid = hierarchy.getTMAGrid();</b>
<b class="nc"><i>130</i>&nbsp;		CoreInfoGrid infoGrid = new CoreInfoGrid(grid);</b>
<i>131</i>&nbsp;		
<i>132</i>&nbsp;		// Create the table
<b class="nc"><i>133</i>&nbsp;		TableView&lt;CoreInfoRow&gt; table = new TableView&lt;&gt;();</b>
<b class="nc"><i>134</i>&nbsp;		table.getItems().setAll(infoGrid.getRows());</b>
<b class="nc"><i>135</i>&nbsp;		for (int c = 0; c &lt; grid.getGridWidth(); c++) {</b>
<b class="nc"><i>136</i>&nbsp;			final int col = c;</b>
<b class="nc"><i>137</i>&nbsp;			TableColumn&lt;CoreInfoRow, TMACoreObject&gt; tableColumn = new TableColumn&lt;&gt;();</b>
<b class="nc"><i>138</i>&nbsp;			tableColumn.setCellValueFactory(column -&gt; new ReadOnlyObjectWrapper&lt;&gt;(column.getValue().get(col)));</b>
<b class="nc"><i>139</i>&nbsp;			tableColumn.setCellFactory(column -&gt; new CoreInfoTableCell());</b>
<b class="nc"><i>140</i>&nbsp;			tableColumn.setResizable(false);</b>
<b class="nc"><i>141</i>&nbsp;			table.getColumns().add(tableColumn);</b>
<i>142</i>&nbsp;		}
<b class="nc"><i>143</i>&nbsp;		table.widthProperty().addListener(c -&gt; {</b>
<b class="nc"><i>144</i>&nbsp;			Pane headerRow = (Pane)table.lookup(&quot;TableHeaderRow&quot;);</b>
<b class="nc"><i>145</i>&nbsp;			headerRow.setMaxHeight(0);</b>
<b class="nc"><i>146</i>&nbsp;			headerRow.setMinHeight(0);</b>
<b class="nc"><i>147</i>&nbsp;			headerRow.setPrefHeight(0);</b>
<b class="nc"><i>148</i>&nbsp;			headerRow.setVisible(false);			</b>
<b class="nc"><i>149</i>&nbsp;		});</b>
<b class="nc"><i>150</i>&nbsp;		table.getSelectionModel().setCellSelectionEnabled(true);</b>
<i>151</i>&nbsp;		
<b class="nc"><i>152</i>&nbsp;		BorderPane pane = new BorderPane();</b>
<b class="nc"><i>153</i>&nbsp;		pane.setCenter(table);</b>
<i>154</i>&nbsp;//		table.setPadding(new Insets(5));
<i>155</i>&nbsp;		
<i>156</i>&nbsp;//		Label label = new Label(&quot;Import TMA map or unique identifiers for TMA cores.&quot;);
<i>157</i>&nbsp;//		pane.setTop(label);
<i>158</i>&nbsp;		
<b class="nc"><i>159</i>&nbsp;		Button btnImportData = new Button(&quot;Import data&quot;);</b>
<b class="nc"><i>160</i>&nbsp;		btnImportData.setTooltip(new Tooltip(&quot;Import TMA core data from a tab-delimited or .csv file&quot;));</b>
<b class="nc"><i>161</i>&nbsp;		btnImportData.setOnAction(e -&gt; {</b>
<b class="nc"><i>162</i>&nbsp;			if (handleImportDataFromFile(infoGrid))</b>
<b class="nc"><i>163</i>&nbsp;				table.refresh();</b>
<b class="nc"><i>164</i>&nbsp;		});</b>
<b class="nc"><i>165</i>&nbsp;		Button btnPasteData = new Button(&quot;Paste data&quot;);</b>
<b class="nc"><i>166</i>&nbsp;		btnPasteData.setTooltip(new Tooltip(&quot;Paste tab-delimited TMA core data from the clipboard&quot;));</b>
<b class="nc"><i>167</i>&nbsp;		btnPasteData.setOnAction(e -&gt; {</b>
<b class="nc"><i>168</i>&nbsp;			if (handleImportDataFromClipboard(infoGrid))</b>
<b class="nc"><i>169</i>&nbsp;				table.refresh();</b>
<b class="nc"><i>170</i>&nbsp;		});</b>
<i>171</i>&nbsp;		
<i>172</i>&nbsp;		
<b class="nc"><i>173</i>&nbsp;		Button btnPasteGrid = new Button(&quot;Paste grid&quot;);</b>
<b class="nc"><i>174</i>&nbsp;		btnPasteGrid.setTooltip(new Tooltip(&quot;Paste a tab-delimited grid containing TMA core names from the clipboard&quot;));</b>
<b class="nc"><i>175</i>&nbsp;		btnPasteGrid.setOnAction(e -&gt; {</b>
<b class="nc"><i>176</i>&nbsp;			if (handlePasteGrid(infoGrid)) {</b>
<b class="nc"><i>177</i>&nbsp;				table.refresh();</b>
<i>178</i>&nbsp;			}
<b class="nc"><i>179</i>&nbsp;		});</b>
<b class="nc"><i>180</i>&nbsp;		Button btnLoadGrid = new Button(&quot;Import grid&quot;);</b>
<b class="nc"><i>181</i>&nbsp;		btnLoadGrid.setTooltip(new Tooltip(&quot;Import a grid containing TMA core names from a tab-delimited or .csv file&quot;));</b>
<b class="nc"><i>182</i>&nbsp;		btnLoadGrid.setOnAction(e -&gt; {</b>
<b class="nc"><i>183</i>&nbsp;			if (handleLoadGridFromFile(infoGrid))</b>
<b class="nc"><i>184</i>&nbsp;				table.refresh();</b>
<b class="nc"><i>185</i>&nbsp;		});</b>
<i>186</i>&nbsp;		
<b class="nc"><i>187</i>&nbsp;		GridPane buttonPane = PaneTools.createColumnGridControls(</b>
<i>188</i>&nbsp;				btnImportData,
<i>189</i>&nbsp;				btnPasteData,
<i>190</i>&nbsp;				btnLoadGrid,
<i>191</i>&nbsp;				btnPasteGrid
<i>192</i>&nbsp;				);
<b class="nc"><i>193</i>&nbsp;		buttonPane.setHgap(10);</b>
<b class="nc"><i>194</i>&nbsp;		buttonPane.setPadding(new Insets(5, 0, 5, 0));</b>
<b class="nc"><i>195</i>&nbsp;		pane.setBottom(buttonPane);</b>
<i>196</i>&nbsp;		
<b class="nc"><i>197</i>&nbsp;		if (Dialogs.builder()</b>
<b class="nc"><i>198</i>&nbsp;			.title(TITLE)</b>
<b class="nc"><i>199</i>&nbsp;			.content(pane)</b>
<b class="nc"><i>200</i>&nbsp;			.buttons(ButtonType.APPLY, ButtonType.CANCEL)</b>
<b class="nc"><i>201</i>&nbsp;			.showAndWait()</b>
<b class="nc"><i>202</i>&nbsp;			.orElse(ButtonType.CANCEL) == ButtonType.APPLY) {</b>
<b class="nc"><i>203</i>&nbsp;			infoGrid.synchronizeTMAGridToInfo();</b>
<b class="nc"><i>204</i>&nbsp;			hierarchy.fireObjectsChangedEvent(infoGrid, new ArrayList&lt;&gt;(grid.getTMACoreList()));</b>
<b class="nc"><i>205</i>&nbsp;			return;</b>
<i>206</i>&nbsp;		}
<i>207</i>&nbsp;		
<b class="nc"><i>208</i>&nbsp;	}</b>
<i>209</i>&nbsp;	
<i>210</i>&nbsp;	
<i>211</i>&nbsp;	private static boolean handleImportDataFromClipboard(final TMAGrid infoGrid) {
<b class="nc"><i>212</i>&nbsp;		logger.trace(&quot;Importing TMA data from clipboard...&quot;);</b>
<b class="nc"><i>213</i>&nbsp;		if (!Clipboard.getSystemClipboard().hasString()) {</b>
<b class="nc"><i>214</i>&nbsp;			Dialogs.showErrorMessage(TITLE, &quot;No text on clipboard!&quot;);</b>
<b class="nc"><i>215</i>&nbsp;			return false;</b>
<i>216</i>&nbsp;		}
<b class="nc"><i>217</i>&nbsp;		int nScores = TMAScoreImporter.importFromCSV(Clipboard.getSystemClipboard().getString(), createPseudoHierarchy(infoGrid));</b>
<b class="nc"><i>218</i>&nbsp;		if (nScores == 1)</b>
<b class="nc"><i>219</i>&nbsp;			Dialogs.showMessageDialog(TITLE, &quot;Updated 1 core&quot;);</b>
<i>220</i>&nbsp;		else 
<b class="nc"><i>221</i>&nbsp;			Dialogs.showMessageDialog(TITLE, &quot;Updated &quot; + nScores + &quot; cores&quot;);</b>
<b class="nc"><i>222</i>&nbsp;		return nScores &gt; 0;</b>
<i>223</i>&nbsp;	}
<i>224</i>&nbsp;	
<i>225</i>&nbsp;	
<i>226</i>&nbsp;	private static boolean handleImportDataFromFile(final TMAGrid infoGrid) {
<b class="nc"><i>227</i>&nbsp;		logger.trace(&quot;Importing TMA data from file...&quot;);</b>
<b class="nc"><i>228</i>&nbsp;		File file = Dialogs.promptForFile(null, null, &quot;Text file&quot;, new String[]{&quot;csv&quot;, &quot;txt&quot;});</b>
<b class="nc"><i>229</i>&nbsp;		if (file == null)</b>
<b class="nc"><i>230</i>&nbsp;			return false;</b>
<i>231</i>&nbsp;		try {
<b class="nc"><i>232</i>&nbsp;			int nScores = TMAScoreImporter.importFromCSV(file, createPseudoHierarchy(infoGrid));</b>
<b class="nc"><i>233</i>&nbsp;			if (nScores == 1)</b>
<b class="nc"><i>234</i>&nbsp;				Dialogs.showMessageDialog(TITLE, &quot;Updated 1 core&quot;);</b>
<i>235</i>&nbsp;			else 
<b class="nc"><i>236</i>&nbsp;				Dialogs.showMessageDialog(TITLE, &quot;Updated &quot; + nScores + &quot; cores&quot;);</b>
<i>237</i>&nbsp;//			logger.info(String.format(&quot;Scores read for %d core(s)&quot;, nScores));
<b class="nc"><i>238</i>&nbsp;			return nScores &gt; 0;</b>
<b class="nc"><i>239</i>&nbsp;		} catch (IOException e) {</b>
<b class="nc"><i>240</i>&nbsp;			Dialogs.showErrorMessage(TITLE, e.getLocalizedMessage());</b>
<b class="nc"><i>241</i>&nbsp;			return false;</b>
<i>242</i>&nbsp;		}
<i>243</i>&nbsp;	}
<i>244</i>&nbsp;	
<i>245</i>&nbsp;	
<i>246</i>&nbsp;	/**
<i>247</i>&nbsp;	 * Creating a pseudo hierarchy makes it possible to make changes without modifying the &#39;true&#39; underlying hierarchy,
<i>248</i>&nbsp;	 * which enables them to be reversible.
<i>249</i>&nbsp;	 * 
<i>250</i>&nbsp;	 * @param grid
<i>251</i>&nbsp;	 * @return
<i>252</i>&nbsp;	 */
<i>253</i>&nbsp;	private static PathObjectHierarchy createPseudoHierarchy(final TMAGrid grid) {
<b class="nc"><i>254</i>&nbsp;		PathObjectHierarchy hierarchy = new PathObjectHierarchy();</b>
<b class="nc"><i>255</i>&nbsp;		hierarchy.setTMAGrid(grid);</b>
<b class="nc"><i>256</i>&nbsp;		return hierarchy;</b>
<i>257</i>&nbsp;	}
<i>258</i>&nbsp;	
<i>259</i>&nbsp;	
<i>260</i>&nbsp;	
<i>261</i>&nbsp;	/**
<i>262</i>&nbsp;	 * Call &lt;code&gt;handleImportGrid&lt;/code&gt; using any text on the System clipboard as input.
<i>263</i>&nbsp;	 * 
<i>264</i>&nbsp;	 * @param infoGrid
<i>265</i>&nbsp;	 * @return
<i>266</i>&nbsp;	 */
<i>267</i>&nbsp;	private static boolean handlePasteGrid(final TMAGrid infoGrid) {
<b class="nc"><i>268</i>&nbsp;		logger.trace(&quot;Importing TMA grid from clipboard...&quot;);</b>
<b class="nc"><i>269</i>&nbsp;		if (!Clipboard.getSystemClipboard().hasString()) {</b>
<b class="nc"><i>270</i>&nbsp;			Dialogs.showErrorMessage(TITLE, &quot;No text on clipboard!&quot;);</b>
<b class="nc"><i>271</i>&nbsp;			return false;</b>
<i>272</i>&nbsp;		}
<b class="nc"><i>273</i>&nbsp;		return handleImportGrid(infoGrid, Clipboard.getSystemClipboard().getString());</b>
<i>274</i>&nbsp;	}
<i>275</i>&nbsp;	
<i>276</i>&nbsp;	/**
<i>277</i>&nbsp;	 * Call &lt;code&gt;handleImportGrid&lt;/code&gt;, prompting the user to select a text file.
<i>278</i>&nbsp;	 * 
<i>279</i>&nbsp;	 * @param infoGrid
<i>280</i>&nbsp;	 * @return
<i>281</i>&nbsp;	 */
<i>282</i>&nbsp;	private static boolean handleLoadGridFromFile(final TMAGrid infoGrid) {
<b class="nc"><i>283</i>&nbsp;		logger.trace(&quot;Importing TMA grid from file...&quot;);</b>
<b class="nc"><i>284</i>&nbsp;		File file = Dialogs.promptForFile(null, null, &quot;Text file&quot;, new String[]{&quot;csv&quot;, &quot;txt&quot;});</b>
<b class="nc"><i>285</i>&nbsp;		if (file == null)</b>
<b class="nc"><i>286</i>&nbsp;			return false;</b>
<i>287</i>&nbsp;		Scanner scanner;
<i>288</i>&nbsp;		try {
<b class="nc"><i>289</i>&nbsp;			scanner = new Scanner(file);</b>
<b class="nc"><i>290</i>&nbsp;			scanner.useDelimiter(&quot;\\Z&quot;);</b>
<b class="nc"><i>291</i>&nbsp;			String text = scanner.next();</b>
<b class="nc"><i>292</i>&nbsp;			scanner.close();</b>
<b class="nc"><i>293</i>&nbsp;			return handleImportGrid(infoGrid, text);</b>
<b class="nc"><i>294</i>&nbsp;		} catch (FileNotFoundException e) {</b>
<b class="nc"><i>295</i>&nbsp;			Dialogs.showErrorMessage(TITLE, &quot;File &quot; + file.getName() + &quot; could not be read&quot;);</b>
<b class="nc"><i>296</i>&nbsp;			return false;</b>
<i>297</i>&nbsp;		}
<i>298</i>&nbsp;	}
<i>299</i>&nbsp;	
<i>300</i>&nbsp;	/**
<i>301</i>&nbsp;	 * Update the CoreInfoGrid with a text containing Unique IDs arranged as a grid with tab or comma delimiters.
<i>302</i>&nbsp;	 * 
<i>303</i>&nbsp;	 * @param infoGrid
<i>304</i>&nbsp;	 * @param text
<i>305</i>&nbsp;	 * @return
<i>306</i>&nbsp;	 */
<i>307</i>&nbsp;	private static boolean handleImportGrid(final TMAGrid infoGrid, final String text) {
<i>308</i>&nbsp;		// Try to create a string grid
<b class="nc"><i>309</i>&nbsp;		List&lt;String[]&gt; rows = new ArrayList&lt;&gt;();</b>
<b class="nc"><i>310</i>&nbsp;		int nCols = -1;</b>
<b class="nc"><i>311</i>&nbsp;		for (String row : GeneralTools.splitLines(text)) {</b>
<i>312</i>&nbsp;			String[] cols;
<b class="nc"><i>313</i>&nbsp;			if (row.contains(&quot;\t&quot;))</b>
<b class="nc"><i>314</i>&nbsp;				cols = row.split(&quot;\t&quot;);</b>
<b class="nc"><i>315</i>&nbsp;			else if (row.contains(&quot;,&quot;))</b>
<b class="nc"><i>316</i>&nbsp;				cols = row.split(&quot;,&quot;);</b>
<i>317</i>&nbsp;			else
<i>318</i>&nbsp;				// Stop at the first empty row (lacking delimiters)
<i>319</i>&nbsp;				break;
<b class="nc"><i>320</i>&nbsp;			if (cols.length &gt; nCols)</b>
<b class="nc"><i>321</i>&nbsp;				nCols = cols.length;</b>
<b class="nc"><i>322</i>&nbsp;			rows.add(cols);</b>
<i>323</i>&nbsp;		}
<b class="nc"><i>324</i>&nbsp;		if (nCols &lt; 0) {</b>
<b class="nc"><i>325</i>&nbsp;			Dialogs.showErrorMessage(TITLE, &quot;Could not identify tab or comma delimited columns&quot;);</b>
<b class="nc"><i>326</i>&nbsp;			return false;</b>
<i>327</i>&nbsp;		}
<i>328</i>&nbsp;		
<i>329</i>&nbsp;		// Check if we have a suitable grid size, and whether or not we have column/row headers
<b class="nc"><i>330</i>&nbsp;		int nRows = rows.size();</b>
<b class="nc"><i>331</i>&nbsp;		if ((nRows != infoGrid.getGridHeight() || nCols != infoGrid.getGridWidth()) &amp;&amp;</b>
<b class="nc"><i>332</i>&nbsp;				(nRows != infoGrid.getGridHeight()+1 || nCols != infoGrid.getGridWidth()+1)) {</b>
<b class="nc"><i>333</i>&nbsp;			Dialogs.showErrorMessage(TITLE, String.format(&quot;Grid sizes inconsistent: TMA grid is %d x %d, but text grid is %d x %d&quot;, infoGrid.getGridHeight(), infoGrid.getGridWidth(), nRows, nCols));</b>
<b class="nc"><i>334</i>&nbsp;			return false;</b>
<i>335</i>&nbsp;		}
<b class="nc"><i>336</i>&nbsp;		boolean hasHeaders = nRows == infoGrid.getGridHeight()+1;</b>
<b class="nc"><i>337</i>&nbsp;		for (int ri = hasHeaders ? 1 : 0; ri &lt; rows.size(); ri++) {</b>
<b class="nc"><i>338</i>&nbsp;			String[] cols = rows.get(ri);</b>
<b class="nc"><i>339</i>&nbsp;			int r = hasHeaders ? ri-1 : ri;</b>
<b class="nc"><i>340</i>&nbsp;			for (int ci = hasHeaders ? 1 : 0; ci &lt; nCols; ci++) {</b>
<b class="nc"><i>341</i>&nbsp;				int c = hasHeaders ? ci-1 : ci;</b>
<b class="nc"><i>342</i>&nbsp;				if (ci &gt;= cols.length)</b>
<b class="nc"><i>343</i>&nbsp;					infoGrid.getTMACore(r, c).setUniqueID(null);</b>
<i>344</i>&nbsp;				else {
<b class="nc"><i>345</i>&nbsp;					String id = cols[ci];</b>
<b class="nc"><i>346</i>&nbsp;					if (id.trim().length() == 0)</b>
<b class="nc"><i>347</i>&nbsp;						id = null;</b>
<b class="nc"><i>348</i>&nbsp;					infoGrid.getTMACore(r, c).setUniqueID(id);</b>
<i>349</i>&nbsp;				}
<i>350</i>&nbsp;				// Set header, if required
<b class="nc"><i>351</i>&nbsp;				if (hasHeaders) {</b>
<b class="nc"><i>352</i>&nbsp;					String header = rows.get(ri)[0] + &quot;-&quot; + rows.get(0)[ci];</b>
<b class="nc"><i>353</i>&nbsp;					infoGrid.getTMACore(r, c).setName(header);</b>
<i>354</i>&nbsp;				}
<i>355</i>&nbsp;			}			
<i>356</i>&nbsp;		}
<b class="nc"><i>357</i>&nbsp;		return true;</b>
<i>358</i>&nbsp;	}
<i>359</i>&nbsp;	
<i>360</i>&nbsp;	
<i>361</i>&nbsp;	
<b class="nc"><i>362</i>&nbsp;	static class CoreInfoTableCell extends TableCell&lt;CoreInfoRow, TMACoreObject&gt; {</b>
<i>363</i>&nbsp;		
<b class="nc"><i>364</i>&nbsp;		private Tooltip tooltip = new Tooltip();</b>
<i>365</i>&nbsp;		
<i>366</i>&nbsp;		@Override
<i>367</i>&nbsp;		public void updateItem(TMACoreObject item, boolean empty) {
<b class="nc"><i>368</i>&nbsp;			super.updateItem(item, empty);</b>
<b class="nc"><i>369</i>&nbsp;			setWidth(150);</b>
<b class="nc"><i>370</i>&nbsp;			setHeight(150);</b>
<b class="nc"><i>371</i>&nbsp;			setMaxWidth(200);</b>
<b class="nc"><i>372</i>&nbsp;			setMaxHeight(200);</b>
<b class="nc"><i>373</i>&nbsp;			if (item == null || empty) {</b>
<b class="nc"><i>374</i>&nbsp;				setText(null);</b>
<b class="nc"><i>375</i>&nbsp;				setGraphic(null);</b>
<b class="nc"><i>376</i>&nbsp;				setTooltip(null);</b>
<b class="nc"><i>377</i>&nbsp;				return;</b>
<i>378</i>&nbsp;			}
<b class="nc"><i>379</i>&nbsp;			if (item.isMissing())</b>
<b class="nc"><i>380</i>&nbsp;				setTextFill(ColorToolsFX.getCachedColor(PathPrefs.colorTMAMissingProperty().get()));</b>
<i>381</i>&nbsp;			else
<b class="nc"><i>382</i>&nbsp;				setTextFill(ColorToolsFX.getCachedColor(PathPrefs.colorTMAProperty().get()));</b>
<i>383</i>&nbsp;			
<b class="nc"><i>384</i>&nbsp;			setAlignment(Pos.CENTER);</b>
<b class="nc"><i>385</i>&nbsp;			setTextAlignment(TextAlignment.CENTER);</b>
<b class="nc"><i>386</i>&nbsp;			setContentDisplay(ContentDisplay.CENTER);</b>
<b class="nc"><i>387</i>&nbsp;			setText(getDisplayString(item));</b>
<b class="nc"><i>388</i>&nbsp;			tooltip.setText(getExtendedDescription(item));</b>
<b class="nc"><i>389</i>&nbsp;			setTooltip(tooltip);</b>
<b class="nc"><i>390</i>&nbsp;		}</b>
<i>391</i>&nbsp;		
<i>392</i>&nbsp;	}
<i>393</i>&nbsp;	
<i>394</i>&nbsp;	
<i>395</i>&nbsp;	/**
<i>396</i>&nbsp;	 * A row of CoreInfo objects - useful for tabular display.
<i>397</i>&nbsp;	 */
<i>398</i>&nbsp;	static class CoreInfoRow {
<i>399</i>&nbsp;		
<i>400</i>&nbsp;		private CoreInfo[] list;
<i>401</i>&nbsp;		
<b class="nc"><i>402</i>&nbsp;		CoreInfoRow(final int capacity) {</b>
<b class="nc"><i>403</i>&nbsp;			list = new CoreInfo[capacity];</b>
<i>404</i>&nbsp;		}
<i>405</i>&nbsp;		
<i>406</i>&nbsp;		public CoreInfo get(int col) {
<b class="nc"><i>407</i>&nbsp;			return list[col];</b>
<i>408</i>&nbsp;		}
<i>409</i>&nbsp;
<i>410</i>&nbsp;		private void set(CoreInfo info, int col) {
<b class="nc"><i>411</i>&nbsp;			list[col] = info;</b>
<i>412</i>&nbsp;		}
<i>413</i>&nbsp;
<i>414</i>&nbsp;	}
<i>415</i>&nbsp;	
<i>416</i>&nbsp;	
<i>417</i>&nbsp;	/**
<i>418</i>&nbsp;	 * Specialized TMAGrid to replace TMACoreObjects with CoreInfo objects -
<i>419</i>&nbsp;	 * the reason being to intercept modifications, thereby allowing them to 
<i>420</i>&nbsp;	 * be either applied to the underlying &#39;true&#39; TMAGrid or reverted.
<i>421</i>&nbsp;	 */
<i>422</i>&nbsp;	private static class CoreInfoGrid implements TMAGrid {
<i>423</i>&nbsp;		
<i>424</i>&nbsp;		private static final long serialVersionUID = 1L;
<i>425</i>&nbsp;		
<i>426</i>&nbsp;		private TMAGrid grid;
<b class="nc"><i>427</i>&nbsp;		private Map&lt;TMACoreObject, CoreInfo&gt; coreMap = new LinkedHashMap&lt;&gt;();</b>
<b class="nc"><i>428</i>&nbsp;		private List&lt;CoreInfoRow&gt; rows = new ArrayList&lt;&gt;();</b>
<i>429</i>&nbsp;				
<b class="nc"><i>430</i>&nbsp;		CoreInfoGrid(final TMAGrid grid) {</b>
<b class="nc"><i>431</i>&nbsp;			this.grid = grid;</b>
<b class="nc"><i>432</i>&nbsp;			for (int y = 0; y &lt; getGridHeight(); y++) {</b>
<b class="nc"><i>433</i>&nbsp;				CoreInfoRow row = new CoreInfoRow(getGridWidth());</b>
<b class="nc"><i>434</i>&nbsp;				for (int x = 0; x &lt; getGridWidth(); x++) {</b>
<b class="nc"><i>435</i>&nbsp;					TMACoreObject core = grid.getTMACore(y, x);</b>
<b class="nc"><i>436</i>&nbsp;					CoreInfo coreInfo = new CoreInfo(core);</b>
<b class="nc"><i>437</i>&nbsp;					row.set(coreInfo, x);</b>
<b class="nc"><i>438</i>&nbsp;					coreMap.put(core, coreInfo);</b>
<i>439</i>&nbsp;				}
<b class="nc"><i>440</i>&nbsp;				rows.add(row);</b>
<i>441</i>&nbsp;			}
<i>442</i>&nbsp;		}
<i>443</i>&nbsp;		
<i>444</i>&nbsp;		public List&lt;CoreInfoRow&gt; getRows() {
<b class="nc"><i>445</i>&nbsp;			return Collections.unmodifiableList(rows);</b>
<i>446</i>&nbsp;		}
<i>447</i>&nbsp;		
<i>448</i>&nbsp;		public void synchronizeTMAGridToInfo() {
<b class="nc"><i>449</i>&nbsp;			coreMap.values().forEach(c -&gt; c.synchronizeCoreToFields());</b>
<i>450</i>&nbsp;		}
<i>451</i>&nbsp;
<i>452</i>&nbsp;		@Override
<i>453</i>&nbsp;		public int nCores() {
<b class="nc"><i>454</i>&nbsp;			return grid.nCores();</b>
<i>455</i>&nbsp;		}
<i>456</i>&nbsp;
<i>457</i>&nbsp;		@Override
<i>458</i>&nbsp;		public int getGridWidth() {
<b class="nc"><i>459</i>&nbsp;			return grid.getGridWidth();</b>
<i>460</i>&nbsp;		}
<i>461</i>&nbsp;
<i>462</i>&nbsp;		@Override
<i>463</i>&nbsp;		public int getGridHeight() {
<b class="nc"><i>464</i>&nbsp;			return grid.getGridHeight();</b>
<i>465</i>&nbsp;		}
<i>466</i>&nbsp;
<i>467</i>&nbsp;		@Override
<i>468</i>&nbsp;		public TMACoreObject getTMACore(String coreName) {
<b class="nc"><i>469</i>&nbsp;			return coreMap.get(grid.getTMACore(coreName));</b>
<i>470</i>&nbsp;		}
<i>471</i>&nbsp;
<i>472</i>&nbsp;		@Override
<i>473</i>&nbsp;		public TMACoreObject getTMACore(int row, int col) {
<b class="nc"><i>474</i>&nbsp;			return coreMap.get(grid.getTMACore(row, col));</b>
<i>475</i>&nbsp;		}
<i>476</i>&nbsp;
<i>477</i>&nbsp;		@Override
<i>478</i>&nbsp;		public List&lt;TMACoreObject&gt; getTMACoreList() {
<b class="nc"><i>479</i>&nbsp;			return new ArrayList&lt;&gt;(coreMap.values());</b>
<i>480</i>&nbsp;		}
<i>481</i>&nbsp;		
<i>482</i>&nbsp;	}
<i>483</i>&nbsp;	
<i>484</i>&nbsp;	
<i>485</i>&nbsp;//	/**
<i>486</i>&nbsp;//	 * Specialized TMAGrid to replace TMACoreObjects with CoreInfo objects -
<i>487</i>&nbsp;//	 * the reason being to intercept modifications, thereby allowing them to 
<i>488</i>&nbsp;//	 * be either applied to the underlying &#39;true&#39; TMAGrid or reverted.
<i>489</i>&nbsp;//	 */
<i>490</i>&nbsp;//	private static class CoreInfoGrid extends DefaultTMAGrid {
<i>491</i>&nbsp;//		
<i>492</i>&nbsp;//		private static final long serialVersionUID = 1L;
<i>493</i>&nbsp;//		
<i>494</i>&nbsp;//		private List&lt;CoreInfoRow&gt; rows = new ArrayList&lt;&gt;();
<i>495</i>&nbsp;//				
<i>496</i>&nbsp;//		CoreInfoGrid(final TMAGrid grid) {
<i>497</i>&nbsp;//			super(grid.getTMACoreList().stream().map(c -&gt; new CoreInfo(c)).collect(Collectors.toList()), grid.getGridWidth());
<i>498</i>&nbsp;//			for (int y = 0; y &lt; getGridHeight(); y++) {
<i>499</i>&nbsp;//				CoreInfoRow row = new CoreInfoRow(getGridWidth());
<i>500</i>&nbsp;//				for (int x = 0; x &lt; getGridWidth(); x++)
<i>501</i>&nbsp;//					row.set((CoreInfo)getTMACore(y, x), x);
<i>502</i>&nbsp;//				rows.add(row);
<i>503</i>&nbsp;//			}
<i>504</i>&nbsp;//		}
<i>505</i>&nbsp;//		
<i>506</i>&nbsp;//		public List&lt;CoreInfoRow&gt; getRows() {
<i>507</i>&nbsp;//			return Collections.unmodifiableList(rows);
<i>508</i>&nbsp;//		}
<i>509</i>&nbsp;//		
<i>510</i>&nbsp;//		public void synchronizeTMAGridToInfo() {
<i>511</i>&nbsp;//			for (int row = 0; row &lt; getGridHeight(); row++) {
<i>512</i>&nbsp;//				for (int col = 0; col &lt; getGridWidth(); col++) {
<i>513</i>&nbsp;//					((CoreInfo)getTMACore(row, col)).synchronizeCoreToFields();
<i>514</i>&nbsp;//				}
<i>515</i>&nbsp;//			}
<i>516</i>&nbsp;//		}
<i>517</i>&nbsp;//		
<i>518</i>&nbsp;//	}
<i>519</i>&nbsp;	
<i>520</i>&nbsp;	
<i>521</i>&nbsp;	/**
<i>522</i>&nbsp;	 * Wrapper for a TMACoreObject that can intercept any changes.
<i>523</i>&nbsp;	 * synchronizeFieldsToCore() should be called to modify the wrapped object.
<i>524</i>&nbsp;	 */
<i>525</i>&nbsp;	static class CoreInfo extends TMACoreObject {
<i>526</i>&nbsp;		
<i>527</i>&nbsp;		private TMACoreObject core;
<i>528</i>&nbsp;		
<i>529</i>&nbsp;		public CoreInfo(final TMACoreObject core) {
<b class="nc"><i>530</i>&nbsp;			super();</b>
<b class="nc"><i>531</i>&nbsp;			this.core = core;</b>
<b class="nc"><i>532</i>&nbsp;			synchronizeFieldsToCore();</b>
<i>533</i>&nbsp;		}
<i>534</i>&nbsp;		
<i>535</i>&nbsp;		/**
<i>536</i>&nbsp;		 * Set the TMA core object&#39;s properties based on the current fields
<i>537</i>&nbsp;		 */
<i>538</i>&nbsp;		private void synchronizeCoreToFields() {
<b class="nc"><i>539</i>&nbsp;			core.setMissing(isMissing());</b>
<b class="nc"><i>540</i>&nbsp;			core.setName(getName());</b>
<b class="nc"><i>541</i>&nbsp;			core.setUniqueID(getUniqueID());</b>
<b class="nc"><i>542</i>&nbsp;			for (String name : getMeasurementList().getMeasurementNames()) {</b>
<b class="nc"><i>543</i>&nbsp;				core.getMeasurementList().putMeasurement(name, getMeasurementList().getMeasurementValue(name));</b>
<b class="nc"><i>544</i>&nbsp;			}</b>
<b class="nc"><i>545</i>&nbsp;			core.getMeasurementList().close();</b>
<b class="nc"><i>546</i>&nbsp;			for (Entry&lt;String, String&gt; entry : getMetadataMap().entrySet()) {</b>
<b class="nc"><i>547</i>&nbsp;				core.putMetadataValue(entry.getKey(), (String)entry.getValue());</b>
<b class="nc"><i>548</i>&nbsp;			}</b>
<i>549</i>&nbsp;		}
<i>550</i>&nbsp;		
<i>551</i>&nbsp;		/**
<i>552</i>&nbsp;		 * Set the fields based on the TMA core object
<i>553</i>&nbsp;		 */
<i>554</i>&nbsp;		private void synchronizeFieldsToCore() {
<b class="nc"><i>555</i>&nbsp;			setMissing(core.isMissing());</b>
<b class="nc"><i>556</i>&nbsp;			setName(core.getName());</b>
<b class="nc"><i>557</i>&nbsp;			setUniqueID(core.getUniqueID());</b>
<i>558</i>&nbsp;		}
<i>559</i>&nbsp;		
<i>560</i>&nbsp;	}
<i>561</i>&nbsp;	
<i>562</i>&nbsp;	
<i>563</i>&nbsp;	static String getDisplayString(final TMACoreObject core) {
<b class="nc"><i>564</i>&nbsp;		StringBuilder sb = new StringBuilder();</b>
<b class="nc"><i>565</i>&nbsp;		sb.append(core.getName()).append(&quot;\n&quot;);</b>
<i>566</i>&nbsp;//		if (isMissing())
<i>567</i>&nbsp;//			sb.append(&quot;(missing)&quot;);
<i>568</i>&nbsp;//		sb.append(&quot;\n&quot;);
<b class="nc"><i>569</i>&nbsp;		if (core.getUniqueID() != null)</b>
<b class="nc"><i>570</i>&nbsp;			sb.append(core.getUniqueID());</b>
<b class="nc"><i>571</i>&nbsp;		sb.append(&quot;\n&quot;);</b>
<b class="nc"><i>572</i>&nbsp;		sb.append(&quot;\n&quot;);</b>
<b class="nc"><i>573</i>&nbsp;		return sb.toString();</b>
<i>574</i>&nbsp;	}
<i>575</i>&nbsp;	
<i>576</i>&nbsp;	
<i>577</i>&nbsp;	static String getExtendedDescription(final TMACoreObject core) {
<b class="nc"><i>578</i>&nbsp;		StringBuilder sb = new StringBuilder();</b>
<b class="nc"><i>579</i>&nbsp;		sb.append(&quot;Name:\t&quot;);</b>
<b class="nc"><i>580</i>&nbsp;		sb.append(core.getName());</b>
<b class="nc"><i>581</i>&nbsp;		if (core.isMissing())</b>
<b class="nc"><i>582</i>&nbsp;			sb.append(&quot; (missing)\n&quot;);</b>
<b class="nc"><i>583</i>&nbsp;		sb.append(&quot;\n&quot;);</b>
<i>584</i>&nbsp;//		sb.append(&quot;ID:\t&quot;);
<i>585</i>&nbsp;//		if (getUniqueID() != null)
<i>586</i>&nbsp;//			sb.append(getUniqueID());
<i>587</i>&nbsp;//		else
<i>588</i>&nbsp;//			sb.append(&quot;-&quot;);
<b class="nc"><i>589</i>&nbsp;		sb.append(&quot;\n&quot;);</b>
<b class="nc"><i>590</i>&nbsp;		for (Entry&lt;String, String&gt; entry : core.getMetadataMap().entrySet()) {</b>
<b class="nc"><i>591</i>&nbsp;			sb.append(entry.getKey()).append(&quot;\t&quot;).append(entry.getValue()).append(&quot;\n&quot;);</b>
<b class="nc"><i>592</i>&nbsp;		}</b>
<b class="nc"><i>593</i>&nbsp;		for (String name : core.getMeasurementList().getMeasurementNames()) {</b>
<b class="nc"><i>594</i>&nbsp;			sb.append(name).append(&quot;\t&quot;).append(core.getMeasurementList().getMeasurementValue(name)).append(&quot;\n&quot;);</b>
<b class="nc"><i>595</i>&nbsp;		}</b>
<b class="nc"><i>596</i>&nbsp;		return sb.toString();</b>
<i>597</i>&nbsp;	}
<i>598</i>&nbsp;	
<i>599</i>&nbsp;	
<i>600</i>&nbsp;}
</div>
</div>

<div class="footer">
    
    <div style="float:right;">generated on 2021-01-25 09:46</div>
</div>
</body>
</html>
